var token = document.getElementsByName('csrf-token')[0].content,
  headers = {
    "X-CSRF-Token": token,
    "X-Requested-With": "XMLHttpRequest",
    Accept: "application/json",
    "Content-Type": "application/json"
  },
  lockButton = document.getElementById("lockButton"),
  lockScreenWrap = document.getElementById("lockScreenWrap"),
  username = document.getElementById("username"),
  password = document.getElementById("password"),
  unlockButton = document.getElementById("unlockButton"),
  storedBreadcrumbs = "";
  
if(lockButton) lockButton.addEventListener("insSidebarFooterButtonEvent", lockScreen);

function lockScreen(e) {
  $.ajax("/api/sessions", {
    headers: headers,
    method: "DELETE",
    data: JSON.stringify({
      form_configuration_name: "modules/insites_core/insites_admin_lock"
    }),
    success: successHandler,
    error: errorHandler
  })
}

function successHandler(e, o, s) {
  204 === s.status && (storedBreadcrumbs = sessionStorage.getItem("ins_breadcrumbs"), sessionStorage.removeItem("ins_breadcrumbs"), lockScreenWrap.classList.remove("unlocked"), document.body.classList.add('locked')), e && e.id && (storedBreadcrumbs = sessionStorage.setItem("ins_breadcrumbs", storedBreadcrumbs), lockScreenWrap.classList.add("unlocked"), document.body.classList.remove('locked'), password.hasError = !1, normalState())
}

function errorHandler(e) {
  422 === e.status && (normalState(), password.hasError = !0, password.errorMessage = "Invalid Password.")
}

function unlockHandler(e) {
  if (password.querySelector("input").value) {
    unlockButton.loading = !0, unlockButton.classList.add("unlocking");
    JSON.parse(document.getElementById("formConfig").innerHTML);
    var o = {
      form_configuration_name: "modules/insites_core/insites_admin_unlock",
      form: {
        email: username.querySelector("input").value,
        password: password.querySelector("input").value
      }
    };
    $.ajax("/api/sessions", {
      headers: headers,
      method: "POST",
      data: JSON.stringify(o),
      success: successHandler,
      error: errorHandler
    })
  } else password.hasError = !0, password.errorMessage = "Password is required."
}

function normalState() {
  unlockButton.classList.remove("unlocking"), unlockButton.loading = !1, password.value = ""
}

function logoutUser(){window.location.assign("/admin/sessions/logout")}
function toastIt(e,o,s){for(var r in s)toastr.options[r]&&(toastr.options[r]=s[r]);toastr.options.preventDuplicates=!0,toastr[e](o)}